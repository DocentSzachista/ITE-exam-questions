# 9. Idea programowania i obliczeń ogólnego przeznaczenia na GPU.

## CPU vs GPU

| CPU | GPU |
|---|---|
|kilka/kilkanaście rdzeni | kilkaset rdzeni|
|Mała liczba operacji wykonywanych operacji równocześnie| Duża ilość operacji wykonywanych równocześnie
|Szybsze przetwarzanie danych sekwencyjnie | szybsze przetwarzanie danych równolegle

## Zastosowanie GPU

- Renderowanie grafiki
    
    - Renderowanie 3D z pomocą raytracing'u
    
    - obliczanie shaderów

- Różnego typu problemy obliczeniowe
    
    - problemy numeryczne (sito Erastotenesa, Komiwojażer)

    - sieci neuronowej (operacje na macierzach)
## Rodzaje pamięci na GPU na podstawie CUDA 

- Rejestry
    - najszybszy rodzaj pamięci
    - każdy wątek ma swoje rejestry na czas życia wątku
    - dane w rejestrach dostępne są tylko dla wątku
- pamięć lokalna
    - przechowywane dane niemieszczące się w rejestrach
    - jest to powolna pamięć 
- pamięć współdzielona
    - wszystkie wątki w bloku ją widzą,
    - umożliwiona komunikacja między wątkami w ramach bloku
    - wydajność porównywalna z rejestrem.
- pamięć stała
    - jedynie do odczytu
    - powolna
    - przechowuje stałe i argumenty kernela
- pamięć tekstur
    - pamięć podręczna 
    - tylko do odczytu
- pamięć globalna 
    - powolna, widoczna dla wszystkich wątków w aplikacji
    - dostępna zarówno dla GPU i CPU 
## Proces obliczeń na GPU
1. Przygotowanie danych do obliczeń na CPU
2. Przydziel pamięć 
    - dla wyników (host)
    - na GPU dla danych wejściowych i wyników
3. Skopiuj danej na GPU
4. Uruchom jądro GPU
5. Kopiuj dane wyjściowe do hosta.

## Biblioteki do programowania na GPU

|CUDA|OpenCL|
|---|---|
| Dedykowane dla NVIDII| Charaketer wieloplatformowy|
| Dużo zestawów narzędzi i bibliotek | Umiarkowane wsparcie dla narzędzi zewnętrznych|
| Tylko GPU NVIDIA | CPU /FPGA/ GPU / ASIC
| Close source | Open Source|


## Problemy programowania na GPU

- konieczność przesyłu danych z CPU do GPU przez magistralę
    - jeżeli przesyłane są pomniejsze zadania, to ich wykonanie na CPU będzie prawdopodobnie szybsze
    - Najlepiej jest od razu przesłać wszystkie dane wymagane do obliczeń
- wątki na GPU są wolniejsze od CPU, więc nieopłącalne jest wykonywanie obliczęń szeregowych na nich. 
- OpenCL jest bardziej przenośną technologią, lecz jest mniej przykładów 

## Jak optymalizować 
- wykorzystać metryki wydajności kerneli
- określić co ogranicza wydajność kerneli
- analiza potencjalnych nieefektywności i próba optymalizacji co do możliwości kodu / sprzętu 
